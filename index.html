<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSC GS MASTER PRO - STABLE VERSION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --primary: #2563eb; }
        .dark { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --primary: #3b82f6; }
        body { background-color: var(--bg); color: var(--text); transition: 0.3s ease; font-family: sans-serif; overflow-x: hidden; }
        .card { background-color: var(--card); border: 1px solid rgba(0,0,0,0.05); }
        .sidebar { transition: 0.4s transform; z-index: 1000; }
        .option-btn { width: 100%; text-align: left; padding: 15px; margin: 8px 0; border-radius: 12px; border: 2px solid #e2e8f0; background: var(--card); transition: 0.2s; font-weight: 500; }
        .dark .option-btn { border-color: #334155; }
        .correct { background: #dcfce7 !important; border-color: #22c55e !important; color: #166534; }
        .wrong { background: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b; }
        .explanation-box { background: #eff6ff; border-left: 4px solid #3b82f6; padding: 15px; margin-top: 15px; border-radius: 10px; font-size: 14px; animation: slideIn 0.3s ease; }
        .dark .explanation-box { background: #1e293b; color: #cbd5e1; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="light">

    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2105/2105-preview.mp3"></audio>

    <div id="sidebar" class="sidebar fixed top-0 left-0 w-72 h-full card shadow-2xl -translate-x-full">
        <div class="p-6">
            <h2 class="text-xl font-black text-blue-600 mb-8 tracking-tighter">SETTINGS</h2>
            <div class="space-y-6">
                <button onclick="toggleDarkMode()" class="w-full flex items-center justify-between p-3 rounded-xl bg-gray-100 dark:bg-gray-800">
                    <span>Dark Mode</span> <i id="theme-icon" class="fas fa-moon"></i>
                </button>
                <div class="flex items-center justify-between p-3 rounded-xl bg-gray-100 dark:bg-gray-800">
                    <span>Sounds</span>
                    <input type="checkbox" id="soundToggle" checked>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-gray-400 mb-2">Font Size</p>
                    <input type="range" min="14" max="24" value="16" oninput="changeFontSize(this.value)" class="w-full">
                </div>
                <button onclick="location.reload()" class="w-full text-left p-3 font-bold text-blue-600"><i class="fas fa-home"></i> Home Screen</button>
            </div>
        </div>
    </div>
    <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 hidden z-50"></div>

    <nav class="bg-blue-700 text-white p-4 flex justify-between items-center shadow-lg sticky top-0 z-40">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()"><i class="fas fa-bars-staggered"></i></button>
            <h1 class="font-bold">SSC MASTER PRO</h1>
        </div>
        <button onclick="toggleLang()" id="langBtn" class="bg-white/20 px-4 py-1 rounded-full text-xs font-bold uppercase">HI</button>
    </nav>

    <div id="main-app" class="max-w-xl mx-auto p-4">
        <div id="home-view" class="grid grid-cols-2 gap-4">
            <div id="loading" class="col-span-full text-center py-20 text-gray-400">Syncing Data...</div>
        </div>

        <div id="chapter-view" class="hidden">
            <h2 id="chap-title" class="text-lg font-bold mb-4 text-blue-600 border-b pb-2">Chapters</h2>
            <div id="chapter-list" class="space-y-3"></div>
            <button onclick="location.reload()" class="w-full mt-6 text-gray-400 font-bold">‚Üê Back</button>
        </div>

        <div id="article-view" class="hidden">
            <div class="card p-6 rounded-2xl">
                <h2 id="art-title" class="text-xl font-bold text-blue-600 mb-4 border-b pb-2"></h2>
                <div id="art-body" class="text-sm leading-relaxed whitespace-pre-wrap"></div>
                <button onclick="closeArticle()" class="w-full bg-blue-600 text-white p-4 rounded-xl mt-8 font-bold">Back to Chapters</button>
            </div>
        </div>

        <div id="quiz-view" class="hidden">
            <div class="flex justify-between mb-2 px-2"><span id="quiz-progress" class="text-xs font-bold opacity-50"></span></div>
            <div class="card p-6 rounded-3xl shadow-xl min-h-[350px]">
                <div id="quiz-content"></div>
                <div id="feedback-area" class="hidden"></div>
            </div>
            <div class="flex gap-4 mt-6">
                <button id="prevBtn" onclick="prevQ()" class="flex-1 bg-gray-200 p-4 rounded-xl font-bold opacity-30" disabled>Prev</button>
                <button id="nextBtn" onclick="nextQ()" class="flex-1 bg-blue-600 text-white p-4 rounded-xl font-bold">Next</button>
            </div>
        </div>

        <div id="result-view" class="hidden text-center">
            <div class="card p-10 rounded-[40px] shadow-2xl">
                <h2 class="text-gray-400 font-bold uppercase text-xs mb-2">Final Score</h2>
                <div id="final-score" class="text-6xl font-black text-blue-600 mb-6">0/0</div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="location.reload()" class="bg-blue-600 text-white p-4 rounded-2xl font-bold">Restart</button>
                    <button onclick="toggleReview()" class="bg-gray-800 text-white p-4 rounded-2xl font-bold text-sm">Review Ans</button>
                </div>
            </div>
            <div id="review-area" class="hidden mt-6 space-y-4 text-left pb-20"></div>
        </div>
    </div>

    <div id="selection-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-6 z-[100]">
        <div class="card w-full max-w-sm rounded-[32px] p-8 shadow-2xl text-center relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button>
            <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-layer-group text-2xl"></i>
            </div>
            <h3 id="modal-cat-name" class="text-xl font-bold mb-1">Category</h3>
            <p class="text-gray-400 text-xs mb-6">Choose your learning mode</p>
            <div class="grid gap-3">
                <button onclick="openChapterList()" class="w-full bg-blue-600 text-white p-5 rounded-2xl font-bold flex justify-between items-center">
                    <span>üìñ Read Article</span> <i class="fas fa-chevron-right text-[10px]"></i>
                </button>
                <button onclick="startQuiz()" class="w-full bg-emerald-600 text-white p-5 rounded-2xl font-bold flex justify-between items-center">
                    <span>üìù Start Quiz</span> <i class="fas fa-chevron-right text-[10px]"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        const API = 'https://opensheet.elk.sh/1uDHzIhALnR2zmrK13PXyBeFd9KRcUgkOY4kwu_lYqRs/Sheet1';
        let db = [], curCat = '', activeData = [], userChoices = [], curIdx = 0, lang = 'HI', fs = 16;

        fetch(API).then(r => r.json()).then(data => {
            db = data;
            document.getElementById('loading').classList.add('hidden');
            renderHome();
        });

        function renderHome() {
            const container = document.getElementById('home-view'); container.innerHTML = '';
            const cats = [...new Set(db.map(i => i.Category).filter(Boolean))];
            cats.forEach(cat => {
                const div = document.createElement('div');
                div.className = "card p-6 rounded-2xl text-center cursor-pointer hover:scale-95 transition border-b-4 border-blue-600";
                div.innerHTML = `<h3 class="font-bold text-sm">${cat}</h3>`;
                div.onclick = () => { curCat = cat; openSelectionModal(); };
                container.appendChild(div);
            });
        }

        function openSelectionModal() {
            document.getElementById('modal-cat-name').innerText = curCat;
            document.getElementById('selection-modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('selection-modal').classList.add('hidden'); }

        function openChapterList() {
            closeModal();
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('chapter-view').classList.remove('hidden');
            document.getElementById('chap-title').innerText = curCat;
            const list = document.getElementById('chapter-list'); list.innerHTML = '';
            const arts = db.filter(i => i.Category === curCat && i.Type === 'Article').sort((a,b)=>a.Order-b.Order);
            arts.forEach(art => {
                const d = document.createElement('div');
                d.className = "card p-4 rounded-xl flex justify-between items-center font-bold cursor-pointer border-l-4 border-amber-500";
                d.innerHTML = `<span>${art.Order}. ${art.Chapter}</span> <i class="fas fa-chevron-right text-[10px] opacity-20"></i>`;
                d.onclick = () => openArticle(art);
                list.appendChild(d);
            });
        }

        function openArticle(art) {
            document.getElementById('chapter-view').classList.add('hidden');
            document.getElementById('article-view').classList.remove('hidden');
            document.getElementById('art-title').innerText = art.Chapter;
            document.getElementById('art-body').innerText = (lang==='HI' ? art.Explanation_HI : art.Explanation_EN || art.Explanation_HI);
        }

        function startQuiz() {
            closeModal();
            activeData = db.filter(i => i.Category === curCat && i.Type === 'Quiz').sort(()=>0.5-Math.random()).slice(0, 10);
            userChoices = new Array(activeData.length).fill(null);
            curIdx = 0;
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('quiz-view').classList.remove('hidden');
            renderQuestion();
        }

        function renderQuestion() {
            const q = activeData[curIdx];
            const isHI = lang === 'HI';
            const cor = isHI ? q.Correct_HI : q.Correct_EN || q.Correct_HI;
            const opts = isHI ? [q.Opt1_HI, q.Opt2_HI, q.Opt3_HI, q.Opt4_HI] : [q.Opt1_EN, q.Opt2_EN, q.Opt3_EN, q.Opt4_EN];
            const ans = userChoices[curIdx];

            document.getElementById('quiz-progress').innerText = `Question ${curIdx+1}/${activeData.length}`;
            document.getElementById('quiz-content').innerHTML = `
                <h2 style="font-size:${fs}px" class="font-bold mb-6">${isHI ? q.Question_HI : q.Question_EN}</h2>
                <div class="space-y-2">
                    ${opts.map(o => {
                        let cls = "";
                        if(ans) {
                            if(o === cor) cls = "correct";
                            else if(o === ans.sel) cls = "wrong";
                        }
                        return `<button class="option-btn ${cls}" onclick="check('${o}','${cor}','${isHI?q.Explanation_HI:q.Explanation_EN}','${q.Tag}')">${o}</button>`;
                    }).join('')}
                </div>
            `;
            const fb = document.getElementById('feedback-area');
            if(ans) {
                fb.innerHTML = `<div class="explanation-box"><b>Explanation:</b><br>${ans.exp}<br><span class="text-[10px] font-bold text-blue-500 mt-2 block">${ans.tag || ''}</span></div>`;
                fb.classList.remove('hidden');
            } else fb.classList.add('hidden');

            document.getElementById('prevBtn').disabled = (curIdx === 0);
            document.getElementById('prevBtn').style.opacity = (curIdx === 0) ? 0.3 : 1;
        }

        function check(sel, cor, exp, tag) {
            if(userChoices[curIdx]) return;
            const right = (sel === cor);
            userChoices[curIdx] = { sel, cor, exp, tag, isRight: right };
            if(document.getElementById('soundToggle').checked) {
                const s = document.getElementById(right ? 'sound-correct' : 'sound-wrong');
                s.currentTime = 0; s.play();
            }
            renderQuestion();
        }

        function nextQ() { curIdx < activeData.length - 1 ? (curIdx++, renderQuestion()) : finish(); }
        function prevQ() { if(curIdx > 0) { curIdx--; renderQuestion(); } }

        function finish() {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');
            const score = userChoices.filter(u => u?.isRight).length;
            document.getElementById('final-score').innerText = `${score}/${activeData.length}`;
        }

        function toggleReview() {
            const area = document.getElementById('review-area'); area.classList.toggle('hidden');
            area.innerHTML = userChoices.map((u, i) => `
                <div class="card p-4 rounded-xl border-l-4 ${u?.isRight ? 'border-green-500' : 'border-red-500'}">
                    <p class="font-bold text-sm">${lang==='HI' ? activeData[i].Question_HI : activeData[i].Question_EN}</p>
                    <p class="text-xs text-green-600 mt-1">Ans: ${u?.cor}</p>
                </div>
            `).join('');
        }

        function toggleLang() { 
            lang = (lang === 'HI' ? 'EN' : 'HI'); 
            document.getElementById('langBtn').innerText = lang;
            if(!document.getElementById('quiz-view').classList.contains('hidden')) renderQuestion();
            if(!document.getElementById('article-view').classList.contains('hidden')) {
                const title = document.getElementById('art-title').innerText;
                const art = db.find(i => i.Chapter === title);
                if(art) openArticle(art);
            }
        }

        function toggleDarkMode() { document.body.classList.toggle('dark'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); document.getElementById('overlay').classList.toggle('hidden'); }
        function changeFontSize(v) { fs = v; if(!document.getElementById('quiz-view').classList.contains('hidden')) renderQuestion(); }
        function closeArticle() { document.getElementById('article-view').classList.add('hidden'); document.getElementById('chapter-view').classList.remove('hidden'); }
    </script>
</body>
</html>
